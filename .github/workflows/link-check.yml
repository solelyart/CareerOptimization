name: Check Markdown Links

on:
  push:
    branches: [ main, master, cursor/** ]
    paths:
      - '**.md'
  pull_request:
    branches: [ main, master ]
    paths:
      - '**.md'
  schedule:
    # Run weekly on Mondays at 9 AM UTC
    - cron: '0 9 * * 1'
  workflow_dispatch:

jobs:
  link-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Check links in markdown files
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          use-quiet-mode: 'no'
          use-verbose-mode: 'yes'
          config-file: '.markdown-link-check.json'
          folder-path: '.'
          file-extension: '.md'
          check-modified-files-only: 'no'
          
      - name: Create issue if links are broken
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            const issueTitle = 'ðŸ”— Broken Links Detected in Markdown Files';
            const issueBody = `
            ## Broken Links Found
            
            The automated link checker has detected broken links in the repository.
            
            **Action Required:**
            1. Review the workflow run logs for details
            2. Fix or remove broken links
            3. Update any outdated URLs
            
            **Workflow Run:** ${context.payload.repository.html_url}/actions/runs/${context.runId}
            
            ---
            *This issue was automatically created by the link-check workflow.*
            `;
            
            // Check if issue already exists
            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              labels: ['broken-links']
            });
            
            if (issues.data.length === 0) {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: issueTitle,
                body: issueBody,
                labels: ['broken-links', 'documentation', 'bug']
              });
            }
